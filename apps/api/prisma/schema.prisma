generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

generator zod {
  provider = "prisma-zod-generator"
  output   = "../src/generated/prisma/zod"
  config   = "./zod-generator.config.json"
}

datasource db {
  provider = "postgresql"
}

// ============================================================================
// ENUMS
// ============================================================================

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum Budget {
  LOW
  MEDIUM
  HIGH
}

enum RecipeSource {
  MANUAL
  IMPORT_URL
  IMPORT_SOCIAL_NETWORK
  IMPORT_IMAGE
  IMPORT_TEXT
}

enum RecipeCategory {
  MAIN_COURSE
  APPETIZER
  SIDE_DISH
  DESSERT
  DRINK
  BREAKFAST
  SNACK
  SOUP
  SALAD
  SAUCE
}

enum RecipeAttribute {
  QUICK
  EASY
  HEALTHY
  VEGETARIAN
}

// ============================================================================
// AUTHENTICATION (Better Auth)
// ============================================================================

model User {
  id            String  @id
  email         String  @unique
  emailVerified Boolean @default(false)
  name          String
  avatar        String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Better Auth
  sessions Session[]
  accounts Account[]

  // Cookmate
  recipes     Recipe[]
  collections Collection[]

  @@map("users")
}

model Session {
  id        String   @id
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("accounts")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("verifications")
}

// ============================================================================
// USER RECIPE
// ============================================================================

model Recipe {
  id             String  @id @default(uuid(7)) @db.Uuid
  name           String
  description    String?
  servings       Int
  yieldUnitLabel String?

  prepTimeMin  Int
  cookTimeMin  Int
  totalTimeMin Int

  difficulty Difficulty
  budget     Budget

  categories RecipeCategory[]  @default([])
  attributes RecipeAttribute[] @default([])

  source    RecipeSource
  sourceUrl String?
  shortUrl  String       @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Owner
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Recipe content
  recipeIngredients  RecipeIngredient[]
  recipeInstructions RecipeInstruction[]
  images             RecipeImage[]

  collections Collection[]

  @@index([userId])
  @@map("recipes")
}

// ============================================================================
// RECIPE CONTENT
// ============================================================================

model RecipeImage {
  id         String @id @default(uuid(7)) @db.Uuid
  storageKey String
  name       String
  mimeType   String
  size       Int
  order      Int    @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  recipeId String @db.Uuid
  recipe   Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
  @@map("recipe_images")
}

model RecipeIngredient {
  id       String   @id @default(uuid(7)) @db.Uuid
  name     String
  quantity Decimal?
  unit     String?
  note     String?
  optional Boolean  @default(false)
  order    Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  recipeId String @db.Uuid
  recipe   Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
  @@map("recipe_ingredients")
}

model RecipeInstruction {
  id          String @id @default(uuid(7)) @db.Uuid
  text        String
  durationMin Int?
  order       Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  recipeId String @db.Uuid
  recipe   Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
  @@map("recipe_instructions")
}

// ============================================================================
// COLLECTIONS
// ============================================================================

model Collection {
  id          String  @id @default(uuid(7)) @db.Uuid
  name        String
  emoji       String
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Creator/owner
  ownerId String
  owner   User   @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  recipes Recipe[]

  @@unique([ownerId, name])
  @@index([ownerId])
  @@map("collections")
}
